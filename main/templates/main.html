{% extends "base.html" %}

{% block content %}
{% include 'navbar.html' %}
<div class=" hidden md:flex fixed right-0 top-0 h-screen w-3/4 bg-blue-700 -z-20" style="clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 80% 0%);">
</div>

<div id="modal-container" onclick="closeAddModal()" class="relative hidden fixed top-0 right-0 z-20 w-full h-screen flex  relative">
    <form id="form" onclick="handleApapun(event)" class=" z-30  my-auto mx-auto flex flex-col min-h-min bg-slate-950 px-4 py-2 rounded-md text-white max-w-[95%] min-w-[18rem] md:w-[28rem] w-[24rem]" autocomplete="off" method="post">
        {% csrf_token %}
        <div class="mb-4">
            <label for="name" class="block text-white text-sm  mb-2">Nama Produk</label>
            <input autocomplete="off" required type="text" name="name"  class=" bg-slate-800 focus:border  text-white  text-sm rounded-xs focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Masukkan nama kamu" id="username">
        </div>
        <div class="mb-4">
            <label for="price" class="block text-white text-sm mb-2">Harga Produk</label>
            <input
                required
                type="number"
                id="price"
                name="price"
                min="1"
                step="1"
                placeholder="Tuliskan harga produk"
                class="bg-slate-800 focus:border  text-white  text-sm rounded-xs focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
            >
        </div>
        <div class="mb-4">
            <label for="description" class=" text-white mb-2 mt-2 text-sm">Deskripsi</label>
            <textarea row="8" required id="description" for="description"name="description" class="bg-slate-800 focus:border  text-white  text-sm rounded-xs focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" type="text" placeholder="Deskripsi tentang produk"></textarea>
        </div>
        
        <div class="mb-4 mt-auto">
            <hr class=" border-2 rounded-md border-[#00A8FF]">
        </div>
        <div class="mb-2 w-full   text-sm flex">
            <button onclick="addProduct()" class="ml-auto px-4 py-2 bg-[#00A8FF] text-black hover:text-white hover:bg-blue-900 rounded-sm"type="submit">Tambah Produk</button>
        </div>
    </form>
</div>

<div class="fixed top-0 right-0 z-10 mt-20 lg:mt-24 ">
    <div class=" mx-4 ">
        <div class="w-full  flex">
            <h1 class="mx-auto font-mono text-xl font-bold md:text-2xl lg:text-4xl text-[#00A8FF] mb-4">Daftar Belanja Kamu</h1>
        </div>
        <div class="w-full  flex">
            <h1 class="mx-auto font-mono text-sm font-bold  text-[#00A8FF] mb-4">Terakhir login: {{last_login}}</h1>
        </div>
        <div class="flex w-full bg-slate-950 flex-wrap rounded-t-md  px-2 py-1 justify-between py-2 md:text-base text-xs text-white">
            <div class="flex flex-col md:flex-row justify-start md:items-center md:space-x-4">
                <h1>Name: <span class="text-[#00A8FF]">{{name}}</span></h1>
                <h1>Class: <span class="text-[#00A8FF]">{{class}}</span> </h1>
            </div>
            <div class="ml-2">
                <button onclick="openAddModal()" class="px-2 py-1 rounded-md bg-slate-800 hover:bg-slate-800"><a >Tambah Produk Baru</a></button>
            </div>
        </div>
    </div>
    <div class=" overflow-x-auto">
        <table class=" mx-4 bg-slate-800 lg:min-w-5xl flex flex-col ">
            <thead class="bg-slate-700 w-full">
            <tr class="w-full  flex text-[#00A8FF] items-stretch md:text-base text-xs uppercase break-words ">
                <th class="min-w-[30%] w-[30%]  text-left pl-2 border-r-2 border-slate-600">Name</th>
                <th class="min-w-[15%] w-[15%] text-left pl-2 border-r-2 border-slate-600">Price</th>
                <th class="flex-grow  text-left pl-2 border-r-2 border-slate-600">Description</th>
                <th class="min-w-[15%] w-[15%] border-r-2 text-left pl-2 border-slate-600">Date Added</th>
                <th class="min-w-[15%] w-[15%] text-left pl-2 ">Operation</th>
            </tr>
            </thead>
        
            {% comment %} Berikut cara memperlihatkan data produk di bawah baris ini {% endcomment %}
            <tbody id="table-body" class=" w-full ">
            
            {% if not products %}
                <tr class="w-full py-4 bg-slate-800 flex items-center justify-center min-h-[12rem] lg:text-base md:text-sm text-xs text-white">
                    <td>
                        <h1>
                            Keranjang belanja Anda masih kosong. Silahkan menambahkan
                        </h1>
                    </td>
                </tr>
            {% else %}
            
            {% endif %}
                
            
            </tbody>
        </table>
    </div>
    <div class="mt-4 flex flex-col  text-white w-full max-w-[98%] mx-auto">
        <table id="product_table" class=" flex flex-col w-full bg-slate-950"></table>
    </div>
</div>
<br />
<script>
    const closeAddModal = async ()=>{
        const ele = document.getElementById("modal-container");
        ele.style.display = "none" // buat menghilang
    }
    const handleApapun = async (event)=>{
        event.stopPropagation();
    }
    const openAddModal = async ()=>{
        const ele = document.getElementById("modal-container");
        ele.style.display = "flex" // buat menghilang
    }
    async function getProducts() {
        return fetch("{% url 'main:get_product_json' %}").then((res) => res.json())
    }
    async function refreshProducts() {
        document.getElementById("product_table").innerHTML = ""
        const products = await getProducts()
        let htmlString = ``
        products.forEach((item) => {
            htmlString+= `\n <tr class="odd:bg-slate-800 even:bg-gray-900 flex items-stretch  flex text-blue-400 items-center lg:text-base md:text-sm text-xs" >
                <td class="min-w-[30%] w-[30%] py-auto my-2  text-justify px-2 ">${item.fields.name}</td>
                <td class="min-w-[15%] w-[15%] text-justify my-2 px-2 ">${item.fields.price}</td>
                <td class="flex-grow  text-justify px-2  my-2 ">${item.fields.description}</td>
                <td class="min-w-[15%] w-[15%] text-justify px-2 my-2  ">${item.fields.date_added}</td>
                <td class="min-w-[15%] w-[15%] text-justify my-2 px-2 ">
                    <div class="flex  flex-col lg:flex-row items-start lg:items-center lg:space-x-4 space-y-4 lg:space-y-0">
                        <button  class=" max-w-full bg-slate-900 hover:bg-blue-900 text-white font-semibold py-2 px-4 rounded-md flex justify-center items-center">
                            <a class="text-xs" href="">Edit</a>
                        </button>
                        <button  class=" max-w-full bg-red-700  hover:bg-red-500 text-white font-semibold py-2 px-4 rounded-md flex justify-center items-center">
                            <a class="text-xs" href=""">Delete</a>
                        </button>
                    </div>
                </td>
            </tr>`
        })
        
        document.getElementById("table-body").innerHTML = htmlString
    }
    function addProduct() {
        fetch("{% url 'main:add_product_ajax' %}", {
            method: "POST",
            body: new FormData(document.querySelector('#form'))
        }).then(refreshProducts)
        document.getElementById("form").reset()
        closeAddModal()
        return false
    }

    refreshProducts()
</script>
{% endblock content %}
    
